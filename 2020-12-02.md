# EXAMEN 1ª EVALUACIÓN 

# El examen consta de 4 apartados:
## 	1. Almacenar la posicion GPS en la base de datos
## 	2. Añadir un XSS
## 	3. Añadir otro valor
## 	4. Hacer la resta

## ¡IMPORTANTE! Lo primero que vamos a hacer para no agobiarnos es dividirlo por partes, lo vamos a hacer poco a poco.

### 1. Nosotros sabemos meter datos en una BBDD MYSQL

``` powershell
<!DOCTYPE html>
<html>

<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<title>P001</title>
</head>

<body>
	<?php
	
	// http://localhost/P001/default.php?enviar=almacenar&nombre=juan3dd
	
		$enviar = "";
		$resultado = "";
				
		$nombre = htmlspecialchars($_GET['nombre']); 
		$enviar = htmlspecialchars($_GET['enviar']); 
		
		$var = "datos.ini";
		$base = parse_ini_file($var);		
		$php = new PDO($base["baseDeDatos"],$base["usuario"],$base["password"]);
		
		if($enviar == "almacenar")
		{
			$con = $php->prepare("INSERT INTO encabezados VALUES (DEFAULT,:tex);");
			$con->bindParam(':tex',$nombre);
			$con->execute();
			?><h1><?php echo "" ?></h1><?php
		}
		else
		{
			$con = $php->prepare("SELECT * from encabezados;");
			$con->execute();
			$registros = $con->fetchAll(PDO::FETCH_NUM);	
			$resultado = $registros[0][1];			
			?><h1><?php echo "$resultado" ?></h1><?php
		}
	?>
</body>

</html>
``` 
### 2. Tambien sabemos sacar la posición GPS y almacenarla en un fichero

```powershell
<?php 

$long = $_POST['longitude'];
$lat = $_POST['latitude'];
$usera=$_SERVER['HTTP_USER_AGENT'];
$ip=$_SERVER['SERVER_ADDR'];
$sname=$_SERVER['SERVER_NAME'];
$soft=$_SERVER['SERVER_SOFTWARE'];
$refer=$_SERVER['HTTP_REFERER'];
$remote=$_SERVER['REMOTE_ADDR'];
$port=$_SERVER['REMOTE_PORT'];


$file = fopen("archivo.txt", "a");
fwrite($file, "longitud" . $long ."|latitud:". $lat . "|User Agent:". $usera . "|Ip:" . $ip .  "|Nombre Servidor" . $sname . "|Software:" . $soft . "|Direccion Web:" . $refer . "|remote Addr:" . $remote . "|Puerto:" . $port .  PHP_EOL);
fclose($file);

?>
``` 
### 3. Lo que no sabemos es como se almacena directamente a la BBDD.

### 4. Añadir un XSS, usaremos el de implementar y reducir realizado en clase el lunes 30-11-2020

``` powershell
<?php
	$numero = isset($_GET['numero'])? $_GET["numero"]: 0;
	$operacion = isset($_GET['operacion'])? $_GET["operacion"]: "";
	echo $operacion;
	if($operacion == "incrementar")
	{
		$num = (int) $numero + 1;
	}
	else
	{
		$num = (int) $numero - 1;
	}
?>

<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>P017</title>
</head>
<body>
	<div id="pagina">
		<form action="./personas.php" method="get">
			<p>
				<label>Número</label>   
				<input type="text" name="numero" value="<?php echo "$num"; ?>" maxlength="5" readonly="readonly" />
			</p>
			<p>
				<input type="submit" name="operacion" value="incrementar"/>
			</p>
			<p>
				<input type="submit" name="operacion" value="reducir"/>
			</p>
		</form>
	</div>
</body>
</html>
```
![Captura](https://user-images.githubusercontent.com/55402125/100919821-9b6c1a00-34da-11eb-9467-df94f80fa0e4.PNG)

### 4. Nos pide que utilicemos otro valor, podemos utilizar un XSS persistente o almacenado.

``` powershell
<script>alert("Voy a salir siempre que incrementes o reduzcas jaja")</script>
```

### 4.1 Quedaria asi

``` powershell
<?php
	$numero = isset($_GET['numero'])? $_GET["numero"]: 0;
	$operacion = isset($_GET['operacion'])? $_GET["operacion"]: "";
	echo $operacion;
	if($operacion == "incrementar")
	{
		$num = (int) $numero + 1;
	}
	else
	{
		$num = (int) $numero - 1;
	}
?>

<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>P017</title>
</head>
<script>alert("Voy a salir siempre que incrementes o reduzcas jaja")</script>
<body>
	<div id="pagina">
		<form action="./personas.php" method="get">
			<p>
				<label>Número</label>   
				<input type="text" name="numero" value="<?php echo "$num"; ?>" maxlength="5" readonly="readonly" />
			</p>
			<p>
				<input type="submit" name="operacion" value="incrementar"/>
			</p>
			<p>
				<input type="submit" name="operacion" value="reducir"/>
			</p>
		</form>
	</div>
</body>
</html>
``` 
![Captura1](https://user-images.githubusercontent.com/55402125/100920011-da9a6b00-34da-11eb-8d3f-e0a4641eb619.PNG)




