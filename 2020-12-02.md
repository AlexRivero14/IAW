# EXAMEN 1 EVALUACION 

# El examen consta de 4 apartados:
## 1. Almacenar la posicion GPS en la base de datos
## 2. Añadir un XSS
## 3. Añadir otro valor
## 4. Hacer la resta

## Lo primero que vamos a hacer para no agobiarnos es dividirlo por partes, lo vamos a hacer poco a poco.

### 1. Nosotros sabemos meter datos en una BBDD MYSQL

``` powershell
<!DOCTYPE html>
<html>

<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<title>P001</title>
</head>

<body>
	<?php
	
	// http://localhost/P001/default.php?enviar=almacenar&nombre=juan3dd
	
		$enviar = "";
		$resultado = "";
				
		$nombre = htmlspecialchars($_GET['nombre']); 
		$enviar = htmlspecialchars($_GET['enviar']); 
		
		$var = "datos.ini";
		$base = parse_ini_file($var);		
		$php = new PDO($base["baseDeDatos"],$base["usuario"],$base["password"]);
		
		if($enviar == "almacenar")
		{
			$con = $php->prepare("INSERT INTO encabezados VALUES (DEFAULT,:tex);");
			$con->bindParam(':tex',$nombre);
			$con->execute();
			?><h1><?php echo "" ?></h1><?php
		}
		else
		{
			$con = $php->prepare("SELECT * from encabezados;");
			$con->execute();
			$registros = $con->fetchAll(PDO::FETCH_NUM);	
			$resultado = $registros[0][1];			
			?><h1><?php echo "$resultado" ?></h1><?php
		}
	?>
</body>

</html>
``` 
### 2. Tambien sabemos sacar la posición GPS y almacenarla en un fichero

```powershell
<?php 

$long = $_POST['longitude'];
$lat = $_POST['latitude'];


$file = fopen("archivo.txt", "a");
fwrite($file, "longitud" . $long ."|latitud:". $lat);
fclose($file);
?>


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>
    <script>

		navigator.geolocation.getCurrentPosition((posicion) => {
    		$.post("http://localhost/gps.php", { latitude : posicion.coords.latitude, longitude : posicion.coords.longitude }, (response) => {
        	console.log(response.results);
   	 	});
	});

    </script>
</body>

</html>
``` 
### 3. Lo que no sabemos es como se almacena directamente a la BBDD.

### 4. Añadir un XSS, usaremos el de implementar y reducir realizado en clase el lunes 30-11-2020

``` powershell
<?php
	$numero = isset($_GET['numero'])? $_GET["numero"]: 0;
	$operacion = isset($_GET['operacion'])? $_GET["operacion"]: "";
	echo $operacion;
	if($operacion == "incrementar")
	{
		$num = (int) $numero + 1;
	}
	else
	{
		$num = (int) $numero - 1;
	}
?>

<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>P017</title>
</head>
<body>
	<div id="pagina">
		<form action="./personas.php" method="get">
			<p>
				<label>Número</label>   
				<input type="text" name="numero" value="<?php echo "$num"; ?>" maxlength="5" readonly="readonly" />
			</p>
			<p>
				<input type="submit" name="operacion" value="incrementar"/>
			</p>
			<p>
				<input type="submit" name="operacion" value="reducir"/>
			</p>
		</form>
	</div>
</body>
</html>
```

### 4. Nos pide que utilicemos otro valor, podemos utilizar un XSS persistente o almacenado.

``` powershell
<script>alert("XSS stored")</script>
```

### 4.1 Quedaria asi

``` powershell
<?php
	$numero = isset($_GET['numero'])? $_GET["numero"]: 0;
	$operacion = isset($_GET['operacion'])? $_GET["operacion"]: "";
	echo $operacion;
	if($operacion == "incrementar")
	{
		$num = (int) $numero + 1;
	}
	else
	{
		$num = (int) $numero - 1;
	}
?>

<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<title>P017</title>
</head>
<script>alert("XSS stored")</script>
<body>
	<div id="pagina">
		<form action="./personas.php" method="get">
			<p>
				<label>Número</label>   
				<input type="text" name="numero" value="<?php echo "$num"; ?>" maxlength="5" readonly="readonly" />
			</p>
			<p>
				<input type="submit" name="operacion" value="incrementar"/>
			</p>
			<p>
				<input type="submit" name="operacion" value="reducir"/>
			</p>
		</form>
	</div>
</body>
</html>
``` 
### 5. Nos pide hacer la resta.



